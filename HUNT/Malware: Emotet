title: Emotet Detection
description: Emotet Malware Hunts
Kill Chain: Install/Exploit
date: 11/4/2022
operating_system: Windows
author: B-Rad 
query: SrcProcName = "regsvr32.exe" AND TgtFileExtension contains anycase "dll" AND Cmdline RegExp "(AppData\\Local\\)"
query: ObjectType = "scheduled_task" AND SrcProcName = "regsvr32.exe" 
XDR: src.process.cmdline contains 'ooccxx'
XDR: src.process.displayName='Microsoft(C) Register Server' #cmdline contains 'AppData' src.process.cmdline contains 'dll' 
XDR (PowerQuery Pie Chart Emotet IP Adresses):
dst.ip.address = * src.process.displayName='Microsoft(C) Register Server' (src.process.cmdline contains 'AppData' || src.process.parent.cmdline contains 'AppData' || osSrc.process.cmdline contains 'AppData' || osSrc.process.parent.cmdline contains 'AppData' || tgt.process.cmdline contains 'AppData') src.process.cmdline contains 'dll' dataSource.category = 'security' dataSource.category = 'security' | columns timestamp , endpoint.name , src.process.displayName , src.process.cmdline , indicator.name , dst.ip.address , dst.port.number
| group count(dst.ip.address) by dst.ip.address
XDR (PowerQuery Pie Chart Emotet Port Numbers): dst.ip.address = * src.process.displayName='Microsoft(C) Register Server' (src.process.cmdline contains 'AppData' || src.process.parent.cmdline contains 'AppData' || osSrc.process.cmdline contains 'AppData' || osSrc.process.parent.cmdline contains 'AppData' || tgt.process.cmdline contains 'AppData') src.process.cmdline contains 'dll' dataSource.category = 'security' dataSource.category = 'security' | columns timestamp , endpoint.name , src.process.displayName , src.process.cmdline , indicator.name , dst.ip.address , dst.port.number
| group count(dst.port.number) by dst.port.number
